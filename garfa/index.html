<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en">
<head>

	<title> Appengine Groovify |  Igor Artamonov GitHub</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />

	<meta name="keywords" content="" />
	<meta name="description" content="" />

	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />

	<script src="/js/jquery-1.5.1.min.js" type="text/javascript"></script>
	<script src="/js/underscore-min.js" type="text/javascript"></script>

	<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Cuprum">
	<link rel="stylesheet" type="text/css" href="/css/style.css"/>
    <link rel="stylesheet" type="text/css" href="/css/pygments.css"/>

    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-55990-12']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>

	<script src="/js/script.js" type="text/javascript"></script>
</head>

<body>
<div class="container-fluid">
    <div class="row-fluid">
        <div class="span2 navigation">
            <ul class="nav nav-list affix"></ul>
        </div>
        <div class="span9 main">
            <h1 id="toc_0">Introduction</h1>

<h2 id="toc_1">Download</h2>

<h2 id="toc_2">License</h2>

<p>Project is licensed under Apache 2 license.</p>

<h1 id="toc_3">How To Use</h1>

<h1 id="toc_4">Basic Samples</h1>

<h1 id="toc_5">Load and Save</h1>

<h2 id="toc_6">Get item by ID</h2>

<p>There is two method for loading data from database:</p>

<ul>
<li>.get(id or key)</li>
<li>.load(id or key)</li>
<li>.getAll(list of ids or keys)</li>
</ul>

<p>First will throw error if there is no object with specified ID, second just
returns <code>null</code> at this case.</p>
<div class="highlight"><pre><span class="n">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">Car</span> <span class="n">car</span> <span class="o">=</span> <span class="n">Car</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">id</span><span class="o">)</span>

<span class="n">Key</span><span class="o">&lt;</span><span class="n">Car</span><span class="o">&gt;</span> <span class="n">carKey</span> <span class="o">=</span> <span class="n">car</span><span class="o">.</span><span class="na">key</span>
<span class="n">Car</span> <span class="n">car2</span> <span class="o">=</span> <span class="n">Car</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">carKey</span><span class="o">)</span>

<span class="n">car</span> <span class="o">=</span> <span class="n">Car</span><span class="o">.</span><span class="na">load</span><span class="o">(</span><span class="n">id</span><span class="o">)</span> <span class="c1">//car can be null if there is no entity with id = 1</span>
</pre></div>
<h2 id="toc_7">Query</h2>

<p>You have direct access to Objectify&#39;s Query, by using two following methods:</p>

<ul>
<li>.findFirst {}</li>
<li>.findAll {}</li>
</ul>

<p>where you can pass the code that can modify any options of passed Query object. Please notice, that query instance,
it&#39;s no a passed parameter, your code will operates directly against query instance, as an DSL.</p>

<p>For example:</p>
<div class="highlight"><pre><span class="n">Car</span><span class="o">.</span><span class="na">findAll</span> <span class="o">{</span>
  <span class="n">filter</span><span class="o">(</span><span class="s1">&#39;vendor =&#39;</span><span class="o">,</span> <span class="s1">&#39;Ford&#39;</span><span class="o">)</span>
  <span class="n">limit</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
<span class="o">}</span>
</pre></div>
<h2 id="toc_8">Find Where</h2>

<p>There is an another method for querying:</p>
<div class="highlight"><pre><span class="n">Clazz</span><span class="o">.</span><span class="na">findWhere</span><span class="o">([&lt;</span><span class="n">fields</span><span class="o">&gt;],</span> <span class="o">[&lt;</span><span class="n">params</span><span class="o">&gt;])</span> <span class="o">{</span>
  <span class="c1">// code executed against Query</span>
<span class="o">}</span>
</pre></div>
<p>where:</p>

<ul>
<li>fields - list of field filters, where keys is or simple field names (that mean equality filter), or string
as fieldname + operator. Like: <code>[model: &#39;Ford&#39;]</code> or <code>[&#39;model =&#39;: &#39;Ford&#39;]</code> or <code>[&#39;count &gt;&#39;: 5]</code>. First two are
equal filters</li>
<li>optional query parameters - like <code>[limit: 4]</code> or <code>[order: &#39;-count&#39;]</code></li>
<li>closure - more flexibility when you need something specific. It&#39;s your code block that will be executed against
prepared Query. Like <code>Car.findWhere([], []) { limit(5) }</code> (btw, it&#39;s the same as <code>.findWhere([], [limit: 5])</code>)</li>
</ul>

<p>For example:</p>
<div class="highlight"><pre><span class="c1">//get maximum 20 cars where count &gt; 10, ordered by count field, descending</span>
<span class="n">List</span> <span class="n">cars</span> <span class="o">=</span> <span class="n">Car</span><span class="o">.</span><span class="na">findWhere</span><span class="o">([</span><span class="s1">&#39;count &gt;&#39;</span><span class="o">:</span> <span class="mi">10</span><span class="o">],</span> <span class="o">[</span><span class="nl">order:</span> <span class="s1">&#39;-count&#39;</span><span class="o">,</span> <span class="nl">limit:</span> <span class="mi">20</span><span class="o">])</span>
</pre></div>
<h1 id="toc_9">Save and Update</h1>

<h2 id="toc_10">Create new data object</h2>

<p>Garfa will automaticalyy add .save() method to your domain classes</p>
<div class="highlight"><pre><span class="n">car</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Car</span><span class="o">(</span>
    <span class="nl">brand:</span> <span class="s1">&#39;Ford&#39;</span><span class="o">,</span>
    <span class="nl">model:</span> <span class="s1">&#39;Mustang&#39;</span><span class="o">,</span>
    <span class="nl">count:</span> <span class="mi">0</span>
<span class="o">)</span>
<span class="n">car</span><span class="o">.</span><span class="na">save</span><span class="o">()</span>
</pre></div>
<h2 id="toc_11">Update item in transaction</h2>

<p>GAE uses optimistic-locking transactions, so, to update an item, we trying to load it
from DB, and execute your code agains this instance. If save is failed, we retry
load-update-save at least 3 times.</p>
<div class="highlight"><pre><span class="n">car</span><span class="o">.</span><span class="na">update</span> <span class="o">{</span> <span class="n">Car</span> <span class="n">loaded</span> <span class="o">-&gt;</span>
  <span class="n">loaded</span><span class="o">.</span><span class="na">count</span><span class="o">++</span>
<span class="o">}</span>
</pre></div>
<p>where:
  * car - current instance
  * loaded - instance loaded for update (can be different from current)</p>

<p>If saving has been failed - it reloads Car from database, and execute your <code>.count++</code>
once again</p>

<h1 id="toc_12">Dynamic Finders</h1>

<p>TO DO</p>

<h1 id="toc_13">Validation</h1>

<p>TO DO</p>

<h1 id="toc_14">Events</h1>

<h2 id="toc_15">.beforeSave</h2>

<p>Called on both insert and update</p>
<div class="highlight"><pre><span class="kd">class</span> <span class="nc">Car</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">beforeSave</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<h2 id="toc_16">.beforeInsert</h2>

<p>Called before first save (when Id is null)</p>
<div class="highlight"><pre><span class="kd">class</span> <span class="nc">Car</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">beforeInsert</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<h2 id="toc_17">.beforeUpdate</h2>

<p>Called before object update</p>
<div class="highlight"><pre><span class="kd">class</span> <span class="nc">Car</span> <span class="o">{</span>
  <span class="kt">void</span> <span class="nf">beforeUpdate</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">...</span>
  <span class="o">}</span>
<span class="o">}</span>
</pre></div>
<h1 id="toc_18">Links</h1>

<h2 id="toc_19">Project Links</h2>

<ul>
<li>Sources - <a href="http://github.com/splix/garfa/">http://github.com/splix/garfa/</a></li>
<li>Post issue - <a href="https://github.com/splix/garfa/issues">https://github.com/splix/garfa/issues</a></li>
</ul>

<h2 id="toc_20">Used technologies</h2>

<ul>
<li>Objectify 3 - <a href="http://code.google.com/p/objectify-appengine/">http://code.google.com/p/objectify-appengine/</a></li>
<li>Google Appengine - <a href="https://developers.google.com/appengine/">https://developers.google.com/appengine/</a></li>
<li>Groovy - <a href="http://groovy.codehaus.org/">http://groovy.codehaus.org/</a></li>
</ul>

<h2 id="toc_21">Author</h2>

<ul>
<li>Igor Artamonov - <a href="http://igorartamonov.com">http://igorartamonov.com</a></li>
<li>The 6 Hours - <a href="http://the6hours.com">http://the6hours.com</a></li>
</ul>

        </div>
    </div>
</div>
<script type="text/javascript">
    Splix.addDocMenu()
</script>
</body>
</html>

